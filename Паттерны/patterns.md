# Цепочка обязанностей
Цепочка обязанностей — это поведенческий паттерн проектирования, который позволяет передавать запросы последовательно по цепочке обработчиков. Каждый последующий обработчик решает, может ли он обработать запрос сам и стоит ли передавать запрос дальше по цепи.

В Go нет четкого понятия для конвейера, это всего лишь один из видов параллельного программирования. Неформальное определение конвейера - это ряд этапов, связанных между собой каналами, где каждый этап это набор go-рутин выполняющих определенную функцию. На каждом этапе выполняются определенные действия:

Получить значения с предыдущего этапа.

Выполняются какие либо действия над этими значениями. Как правило создаются новые значения.

Значения отправляются на следующий этап через выходные каналы.

На всех этапах может быть сколько угодно входящих и выходящих каналов, кроме первого и последнего, на которых есть только выходящий и входящий канал. Первый этап иногда называют источник(source) или отправитель(producer). Последний этап называется потребитель(consumer, sink).

Функция, с которой начинается цепочка:
![CoR](https://github.com/GaponTV/AnonChatVK/blob/master/%D0%9F%D0%B0%D1%82%D1%82%D0%B5%D1%80%D0%BD%D1%8B/images/Cor1.PNG)
Данная функция в начале своей рабботы запускает функцию processLongPollUpdates(lpActions, messages) и создает пустой канал lpActions, в который будет записаны данные, полученные после обработки LongPoll сообщения. 
![CoR](https://github.com/GaponTV/AnonChatVK/blob/master/%D0%9F%D0%B0%D1%82%D1%82%D0%B5%D1%80%D0%BD%D1%8B/images/Cor2.PNG)
После, она отправляет LongPoll-запрос и обрабатывает LongPoll-ответ, декодируя его из json в струтуру данных. При наличии ошибок в ответе функция не отправляет данные на дальнейшуюю обработку.
![CoR](https://github.com/GaponTV/AnonChatVK/blob/master/%D0%9F%D0%B0%D1%82%D1%82%D0%B5%D1%80%D0%BD%D1%8B/images/Cor3.PNG)

При успешной обработке LongPoll-ответа идет запись полей структуры Updates в канал lpActions.

Функция, которая идет следующая по цепочке:
![CoR](https://github.com/GaponTV/AnonChatVK/blob/master/%D0%9F%D0%B0%D1%82%D1%82%D0%B5%D1%80%D0%BD%D1%8B/images/cor4.PNG)
В этой функции данные из канала lpActions обрабатываются и далее передаются в канал messages, если не было обнаружено ошибок.

Далее данные из канала messages обрабатываются в функции:
![CoR](https://github.com/GaponTV/AnonChatVK/blob/master/%D0%9F%D0%B0%D1%82%D1%82%D0%B5%D1%80%D0%BD%D1%8B/images/Cor5.PNG)
В данной функции идет проверка на наличие команды. Если команда не найдена, то дальнейшая обработка отправляется в функцию ProcessSimpleMessage(&msg), а если команда была найдена, то в функцию processCommand(&msg, payload.CommandName)

В данных функциях после обработки, данные отправляются в канал outcomingMessages. В этом канале находятся сообщения, которые необходимо отправить пользователям.

Канал outcomingMessages обрабатывается в функциях:
![CoR](https://github.com/GaponTV/AnonChatVK/blob/master/%D0%9F%D0%B0%D1%82%D1%82%D0%B5%D1%80%D0%BD%D1%8B/images/cor6.PNG)
![CoR](https://github.com/GaponTV/AnonChatVK/blob/master/%D0%9F%D0%B0%D1%82%D1%82%D0%B5%D1%80%D0%BD%D1%8B/images/cor7.PNG)

Далее каждое сообщение преобразуется в json и отправляется LongPoll-запросом.

# Адаптер
Адаптер — это структурный паттерн проектирования, который позволяет объектам с несовместимыми интерфейсами работать вместе.

В этом проекте данный патерн использовался для работы с json форматом данных.

Средства для работы с json в языке Golang реализованы в пакете "encoding/json". Для парсинга данных представленных в json-формате использовалась функция Unmarshal, а для преобразования данных в json использовалась функция Marshal.
Р
ассмотрим на примере из проета использование данного паттерна:
![Adapter](https://github.com/GaponTV/AnonChatVK/blob/master/%D0%9F%D0%B0%D1%82%D1%82%D0%B5%D1%80%D0%BD%D1%8B/images/Adapter1.PNG)

Здесь можно увидеть преобразование из json в струтктуру данных. По умолчанию ключи в json будут соответствовать именам свойств структуры, поэтому для изменения ключей напротив каждого из свойств структуры были дабавлены теги.

![Adapter](https://github.com/GaponTV/AnonChatVK/blob/master/%D0%9F%D0%B0%D1%82%D1%82%D0%B5%D1%80%D0%BD%D1%8B/images/Adapter2.PNG)

А вот здесь можно увидеть преобразование данных из структуры Keyboarg в json, с помощью команды Marshal.

# Наблюдатель
Наблюдатель — это поведенческий паттерн проектирования, который создаёт механизм подписки, позволяющий одним объектам следить и реагировать на события, происходящие в других объектах.

В этом проекте данный паттерн реалезован через стандартные каналы Golang.

Данный паттерн был реализован для работы более крупного в проекте паттерна Цепочка обязанностей.

Функции обработки, с помощью особенностей цикла for, дожидались обработки данных на более ранних стадиях, а затем при попадании обработанных на предыдущем этапе данных в канал, с которым работала функция, начинала обрабатывать данные, которые после обработки отправлялись в следущи канал, который так же прослушивался, с помощью цикла for, другой функцией.

По сути использовалась вариация паттерна Наблюдатель — паттерн PubSub. У pubsub есть event channal. Благодаря event channal у pubsub появляются такие свойства, как слабая связность между компонентами и асинхронность.

# Фасад
Фасад — это структурный паттерн проектирования, который предоставляет простой интерфейс к сложной системе классов, библиотеке или фреймворку. <br>
Фасад в данном проекте реальзуется через интерфейсы:
![Facade](https://github.com/GaponTV/AnonChatVK/blob/master/%D0%9F%D0%B0%D1%82%D1%82%D0%B5%D1%80%D0%BD%D1%8B/images/Facade1.PNG)

Эти интерфейсы используются в функциях:
![Facade](https://github.com/GaponTV/AnonChatVK/blob/master/%D0%9F%D0%B0%D1%82%D1%82%D0%B5%D1%80%D0%BD%D1%8B/images/Facade2.PNG)

Интерфейс предоставляет доступ к объектам:
![Facade](https://github.com/GaponTV/AnonChatVK/blob/master/%D0%9F%D0%B0%D1%82%D1%82%D0%B5%D1%80%D0%BD%D1%8B/images/Facade3.PNG)
![Facade](https://github.com/GaponTV/AnonChatVK/blob/master/%D0%9F%D0%B0%D1%82%D1%82%D0%B5%D1%80%D0%BD%D1%8B/images/Facade4.PNG)
