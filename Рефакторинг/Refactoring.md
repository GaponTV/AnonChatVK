# Рефакторинг
Рефакторинг представляет собой процесс такого изменения программной системы, при котором не меняется внешнее поведение кода, но улучшается его внутренняя структура. Это способ систематического приведения кода в порядок, при котором шансы появления новых ошибок минимальны. В сущности, при проведении рефакторинга кода вы улучшаете его дизайн уже после того, как он написан. <br>
Рефакторинг следует проводить серией небольших изменений, каждое из которых делает существующий код чуть лучше, оставляя программу в рабочем состоянии.

# Признаки того,что нужен рефакторинг

Перед рефакторингом кода нужно определиться, нужен ли он вообще? Определится с эим нам помогут признаки "плохого кода". <br>
Узнать, какие есть признаки, можно из подготовленной мной [презентации](https://github.com/GaponTV/AnonChatVK/blob/master/%D0%9F%D1%80%D0%B5%D0%B7%D0%B5%D0%BD%D1%82%D0%B0%D1%86%D0%B8%D0%B8/%D0%A0%D0%B5%D1%84%D0%B0%D0%BA%D1%82%D0%BE%D1%80%D0%B8%D0%BD%D0%B3.pptx) <br>

# Проверка кода

После того, как мы узнали, какие есть признаки "плохого кода", можно приступать к первому этапу рефакторинга, а именно к проверке кода. <br>
### Начнем с main.go <br>
При проверке кода в main.go выяснилось, что функция msgProcessor(messages <-chan string) уже не используется, то есть был обнаружен "мертвый код". 

### keyboard/keyboards.go
При проверке выяснилось, что весь файл keyboard/keyboards.go устарел и больше не используется

### keyboard_defs/inchat.json
Так же устарел и не используется

### processing/chatProc.go
При проверке обнаружились комментарии перед функцией findChatWithUser(userID int64) (*Chat, int)

### processing/commands.go
При проверке обнаружилось дублирование кода в функции onNextCommand(msg *vkapi.MessageObject) из функций onFindCommand(msg *vkapi.MessageObject) и onStopCommand(msg *vkapi.MessageObject).

### processing/keyboard.go
При проверке проблем не обнаружилось

### processing/vkChatGroup.go
В этом файле были обнаружены комментарии в строках 23, 26 и 81-105

### processing/vkBotApi.go
в этом файле были обнаруженен комментарий в строке 27

# Рефакторинг

Обнаруженный мертвый код был просто удален. После удаления программа была протестированна. Сбоев в работе не обнаружилось.

### Обнаруженные комментарии. 
После их анализа выяснилось, что никакой полезной информации в данный момент они не представляют, кроме одного в файле processing/chatProc.go. Данный комментарий пояснял какие значения возвращает метод. Для решения этой проблемы была переименована переменная "i" на "chatIndex". После переименования программа была протестирована. Сбоев в работе не обнаружилось.

### Обнаруженное дублирование кода. 
Функция onNextCommand(msg *vkapi.MessageObject) являлась комбинаций функций: onFindCommand(msg *vkapi.MessageObject) и onStopCommand(msg *vkapi.MessageObject). <br>
Поэтому ее можно было просто удалить, заменив содержимой кейса в функции processCommand(msg *vkapi.MessageObject, command commandName): <br>
  case CommandNext: <br>
		  grp.onNextCommand(msg) <br>
На <br>
	case CommandNext: <br>
		grp.onStopCommand(msg) <br>
		grp.onFindCommand(msg) <br>
После сделанных изменений программа была протестированна. Проблем не обнаружилось.

# Выводы

В результате проведенного рефакторинга удалось избавится от большого количества лишнего и дублированного кода, а также сделать его понятнее.
